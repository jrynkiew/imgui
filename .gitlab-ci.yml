stages:
  - build-all
  - deploy

build-web:
  artifacts:
    name: "$CI_COMMIT_REF_NAME"
    paths:
      - examples/example_sdl2_opengl3
  variables:
    BUILD_TARGET: web
    GIT_STRATEGY: clone
  tags:
    - web-runner
  stage: build-all
  script:
    - cd examples/example_sdl2_opengl3
    - export PWD_WEB=$PWD
    - cd /build/emsdk/
    - . ./emsdk_env.sh
    - cd $PWD_WEB
    - make -f Makefile.emscripten
  
build-windows:
  variables:
    BUILD_TARGET: windows
    GIT_STRATEGY: clone
    MINGW: /mingw64
  tags:
    - windows-runner
  stage: build-all
  script:
    - cd examples/example_null
    - make

build-windows32:
  variables:
    BUILD_TARGET: windows32
    GIT_STRATEGY: clone
    MINGW: /mingw64
  tags:
    - windows32-runner
  stage: build-all
  script:
    - cd examples/example_null
    - make

build-linux:
  artifacts:
    name: "$CI_COMMIT_REF_NAME"
    paths:
      - examples/example_sdl2_opengl3
  variables:
    BUILD_TARGET: linux
    GIT_STRATEGY: clone
  tags:
    - linux-runner
  stage: build-all
  script:
    - cd examples/example_sdl2_opengl3
    - make

run-web-server:
  tags:
    - web-server
  stage: deploy
  script:
    - cp examples/example_sdl2_opengl3/* /usr/share/nginx/html/
  needs:
    - job: build-web
      artifacts: true